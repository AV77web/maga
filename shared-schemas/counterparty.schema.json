{
  "$id": "https://example.com/schemas/counterparty.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Counterparty",
  "description": "Schema per creazione/aggiornamento di una controparte (cliente o fornitore)",
  "type": "object",
  "required": ["nome", "tipo"],
  "properties": {
    "nome": { "type": "string", "minLength": 1, "maxLength": 255 },
    "tipo": { "type": "string", "enum": ["CLIENTE", "FORNITORE"] },
    "codice_fiscale": { "type": "string", "minLength": 16, "maxLength": 16 },
    "partita_iva": { "type": "string", "minLength": 11, "maxLength": 20 },
    "indirizzo": { "type": "string", "maxLength": 255 },
    "citta": { "type": "string", "maxLength": 100 },
    "cap": { "type": "string", "maxLength": 5, "pattern": "^\\d{5}$" },
    "provincia": { "type": "string", "maxLength": 2 },
    "nazione": { "type": "string", "maxLength": 50 },
    "telefono": { "type": "string", "maxLength": 30 },
    "email": { "type": "string", "format": "email" },
    "contatto": { "type": "string", "maxLength": 100 },
    "note": { "type": "string", "maxLength": 500 }
  },
  "allOf": [
    {
      "if": { "properties": { "tipo": { "const": "FORNITORE" } } },
      "then": { "required": ["partita_iva"] }
    },
    {
      "if": { "properties": { "tipo": { "const": "CLIENTE" } } },
      "then": { "required": ["codice_fiscale"] }
    }
  ],
  "additionalProperties": false,
  "errorMessage": {
    "required": {
      "nome": "Il campo 'nome' è obbligatorio.",
      "tipo": "Il campo 'tipo' è obbligatorio.",
      "codice_fiscale": "Il campo 'codice_fiscale' è obbligatorio quando tipo = CLIENTE.",
      "partita_iva": "Il campo 'partita_iva' è obbligatorio quando tipo = FORNITORE."
    },
    "additionalProperties": "Sono presenti campi non ammessi nella richiesta di controparte."
  }
} 